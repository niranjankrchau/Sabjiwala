<!DOCTYPE html>
<html>
<head>
  <title>Customer View Shops</title>
  <style>
   .banner {
      background: linear-gradient(to right, #ff6a00, #ee0979);
      color: white;
      padding: 40px 20px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      position: relative;
    }

    .banner h1 {
      font-size: 2.5em;
      margin: 0 0 10px;
    }

    .banner p {
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    .banner .btn {
      background-color: white;
      color: #ff6a00;
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 1em;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .banner .btn:hover {
      background-color: #ffe2d1;
      color: #d94c00;
    }
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    button {
      padding: 8px 16px;
      margin: 5px 0 15px 0;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background-color: #007bff;
      color: white;
      font-size: 14px;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body>
<div class="login-card">
  <div class="banner">
  <h1>Sabjiwala</h1>
  <p>Apni Local Dukan</p>
   </div>
  <button onclick="viewOrderHistory()">ðŸ“œ View Order History</button>

  <h2>Available Shops</h2>
  <table border="1" id="shopTable">
    <thead>
      <tr><th>Shop Name</th><th>Address</th><th>Pincode</th><th>View Vegetables</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <br/>
  <button onclick="viewCart()">View Cart</button>

  <script>
    function viewOrderHistory() {
      window.location.href = 'order_history.html';
    }

    function getShops() {
      return JSON.parse(localStorage.getItem('userList') || '[]');
    }

    function renderShops() {
      const tbody = document.querySelector('#shopTable tbody');
      tbody.innerHTML = '';

      const userList = getShops();
      const validityList = JSON.parse(localStorage.getItem('validityList') || '{}');
      const today = new Date();

      userList.forEach(user => {
        const validity = validityList[user.shopId]; // âœ… Correct key

        if (!validity || !validity.startsWith('Valid till:')) return;

        const match = validity.match(/Valid till:\s*(.+)/);
        if (!match) return;

        const expiryDate = new Date(match[1]);
        if (expiryDate < today) return; // Skip expired shops

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.shopName || user.mobile}</td>
          <td>${user.address}</td>
          <td>${user.pincode}</td>
          <td><button onclick="viewVegetables('${user.shopId}')">View Vegetables</button></td>
        `;
        tbody.appendChild(tr);
      });

      if (tbody.children.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td colspan="4" style="text-align:center;">No valid shops available currently.</td>`;
        tbody.appendChild(tr);
      }
    }

      function viewVegetables(shopId) {
      localStorage.setItem('currentShopId', shopId);
       window.location.href = 'customer_vegetables.html';
}


    function viewCart() {
      window.location.href = 'cart.html';
    }

    renderShops();
  </script>
</body>
</html>